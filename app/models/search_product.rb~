class SearchProduct < ApplicationRecord
#attr_accessor :popularity,:term

def self.terms_for(prefix)
	suggestions = where("term like ?", "%#{prefix}%")
	suggestions.limit(10).pluck(:term)
end


def self.index_products
	User.find_each do |user|
		index_term(user.name)
		user.name.split.each{|t| index_term(t) }
	end
	Question.find_each do |question|
		index_term(question.title)
		question.title.split.each{ |t| index_term(t) }
	end
	Article.find_each do |article|
		index_term(article.title)
		article.title.split.each{|t| index_term(t)}
	end	
		
	end

def self.index_term(term)
	where(term: term.downcase).first_or_initialize.tap do |suggestion|
		suggestion.increment! :popularity
	end		 
	end
end
